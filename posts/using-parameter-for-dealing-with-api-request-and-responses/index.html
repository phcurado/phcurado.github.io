<!doctype html><html class="not-ready text-sm lg:text-base" style=--bg:#faf6f1 lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Using Parameter for dealing with API request and responses - phcurado</title><meta name=theme-color><meta name=description content="This is a continuation from the previous article Serializing and Deserializing external data in Elixir.
As previously shown, it&rsquo;s verbose and not always ideal using Ecto Embedded Schemas for loading and validating external parameters. I recently created a library that help solving the problems described on the previous article. Let&rsquo;s reimplement the API schemas using Parameter and see what benefits it will bring.
Modeling the data from an API Considering the below example on how an API endpoint documentation may look like:"><meta name=author content><link rel="preload stylesheet" as=style href=https://phcurado.github.io/main.min.css><link rel=preload as=image href=https://phcurado.github.io/theme.png><link rel=preload as=image href=https://phcurado.github.io/github.svg><link rel=preload as=image href=https://phcurado.github.io/rss.svg><link rel=icon href=https://phcurado.github.io/favicon.ico><link rel=apple-touch-icon href=https://phcurado.github.io/apple-touch-icon.png><meta name=generator content="Hugo 0.110.0"><meta property="og:title" content="Using Parameter for dealing with API request and responses"><meta property="og:description" content="This is a continuation from the previous article Serializing and Deserializing external data in Elixir.
As previously shown, it&rsquo;s verbose and not always ideal using Ecto Embedded Schemas for loading and validating external parameters. I recently created a library that help solving the problems described on the previous article. Let&rsquo;s reimplement the API schemas using Parameter and see what benefits it will bring.
Modeling the data from an API Considering the below example on how an API endpoint documentation may look like:"><meta property="og:type" content="article"><meta property="og:url" content="https://phcurado.github.io/posts/using-parameter-for-dealing-with-api-request-and-responses/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-21T17:53:41+02:00"><meta property="article:modified_time" content="2023-01-21T17:53:41+02:00"><meta itemprop=name content="Using Parameter for dealing with API request and responses"><meta itemprop=description content="This is a continuation from the previous article Serializing and Deserializing external data in Elixir.
As previously shown, it&rsquo;s verbose and not always ideal using Ecto Embedded Schemas for loading and validating external parameters. I recently created a library that help solving the problems described on the previous article. Let&rsquo;s reimplement the API schemas using Parameter and see what benefits it will bring.
Modeling the data from an API Considering the below example on how an API endpoint documentation may look like:"><meta itemprop=datePublished content="2023-01-21T17:53:41+02:00"><meta itemprop=dateModified content="2023-01-21T17:53:41+02:00"><meta itemprop=wordCount content="764"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Using Parameter for dealing with API request and responses"><meta name=twitter:description content="This is a continuation from the previous article Serializing and Deserializing external data in Elixir.
As previously shown, it&rsquo;s verbose and not always ideal using Ecto Embedded Schemas for loading and validating external parameters. I recently created a library that help solving the problems described on the previous article. Let&rsquo;s reimplement the API schemas using Parameter and see what benefits it will bring.
Modeling the data from an API Considering the below example on how an API endpoint documentation may look like:"></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center"><div class="relative z-50 mr-auto flex items-center"><a class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold" href=https://phcurado.github.io/>phcurado</a>
<a class="btn-dark ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.svg)_left_center/cover_no-repeat] dark:invert dark:[background-position:right]"></a></div><a class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"></a>
<script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg=`"#faf6f1"`.replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"><nav class="mt-12 flex justify-center space-x-10 dark:invert lg:mt-0 lg:ml-12 lg:items-center lg:space-x-6"><a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./github.svg) href=https://github.com/phcurado target=_blank></a>
<a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./rss.svg) href=https://phcurado.github.io/index.xml target=_blank></a></nav></div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-20 pb-32 dark:prose-invert"><article><header class=mb-20><h1 class="!my-0 pb-2.5">Using Parameter for dealing with API request and responses</h1><div class="text-sm opacity-60"><time>Jan 21, 2023</time></div></header><section><p>This is a continuation from the previous article <a href=https://phcurado.github.io/posts/serializing-and-deserializing-external-data-in-elixir/>Serializing and Deserializing external data in Elixir</a>.</p><p>As previously shown, it&rsquo;s verbose and not always ideal using Ecto Embedded Schemas for loading and validating external parameters. I recently created a library that help solving the problems described on the previous article. Let&rsquo;s reimplement the API schemas using <a href=https://github.com/phcurado/parameter>Parameter</a> and see what benefits it will bring.</p><h2 id=modeling-the-data-from-an-api>Modeling the data from an API</h2><p>Considering the below example on how an API endpoint documentation may look like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># POST /charge-user</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Request</span>
</span></span><span style=display:flex><span>curl -v -X POST https://api-payment-fictional.com/charge-user <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>-H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>-d <span style=color:#e6db74>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;detail&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;invoiceNumber&#34;: &#34;ABC123&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;currencyCode&#34;: &#34;USD&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;amount&#34;: &#34;500&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;discount&#34;: &#34;10%&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;user&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;firstName&#34;: &#34;John&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;lastName&#34;: &#34;Doe&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Response</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;id&#34;: &#34;1234&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;status&#34;: &#34;NEW&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;detail&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;amount&#34;: &#34;500.00&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;billed&#34;: &#34;450.00&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;currencyCode&#34;: &#34;USD&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}&#39;</span>
</span></span></code></pre></div><p>We can shape this data in two schemas (request and response) using the <a href=https://github.com/phcurado/parameter>Parameter</a> library:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span><span style=color:#75715e># Request</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>defmodule</span> <span style=color:#a6e22e>MyApp.ChargeRequest</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>use</span> <span style=color:#a6e22e>Parameter.Schema</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Parameter by default makes the fields optional but setting this flag</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># will make this behaviour change for all fields</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@fields_required</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  param <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    has_one <span style=color:#e6db74>:details</span>, <span style=color:#a6e22e>Detail</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      field <span style=color:#e6db74>:invoice_number</span>, <span style=color:#e6db74>:string</span>, <span style=color:#e6db74>key</span>: <span style=color:#e6db74>&#34;invoiceNumber&#34;</span>
</span></span><span style=display:flex><span>      field <span style=color:#e6db74>:currency_code</span>, <span style=color:#e6db74>:string</span>, <span style=color:#e6db74>key</span>: <span style=color:#e6db74>&#34;currencyCode&#34;</span>
</span></span><span style=display:flex><span>      field <span style=color:#e6db74>:amount</span>, <span style=color:#e6db74>:decimal</span>
</span></span><span style=display:flex><span>      field <span style=color:#e6db74>:discount</span>, <span style=color:#e6db74>:string</span>
</span></span><span style=display:flex><span>      has_one <span style=color:#e6db74>:user</span>, <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        field <span style=color:#e6db74>:first_name</span>, <span style=color:#e6db74>:string</span>, <span style=color:#e6db74>key</span>: <span style=color:#e6db74>&#34;firstName&#34;</span>
</span></span><span style=display:flex><span>        field <span style=color:#e6db74>:last_name</span>, <span style=color:#e6db74>:string</span>, <span style=color:#e6db74>key</span>: <span style=color:#e6db74>&#34;lastName&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span><span style=color:#75715e># Response</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>defmodule</span> <span style=color:#a6e22e>MyApp.ChargeResponse</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>use</span> <span style=color:#a6e22e>Parameter.Schema</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@fields_required</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  enum <span style=color:#a6e22e>Status</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    value <span style=color:#e6db74>:new</span>, <span style=color:#e6db74>key</span>: <span style=color:#e6db74>&#34;NEW&#34;</span>
</span></span><span style=display:flex><span>    value <span style=color:#e6db74>:charged</span>, <span style=color:#e6db74>key</span>: <span style=color:#e6db74>&#34;CHARGED&#34;</span>
</span></span><span style=display:flex><span>    value <span style=color:#e6db74>:canceled</span>, <span style=color:#e6db74>key</span>: <span style=color:#e6db74>&#34;CANCELED&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  param <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    field <span style=color:#e6db74>:id</span>, <span style=color:#e6db74>:string</span>
</span></span><span style=display:flex><span>    field <span style=color:#e6db74>:status</span>, <span style=color:#a6e22e>MyApp.ChargeResponse.Status</span>
</span></span><span style=display:flex><span>    has_one <span style=color:#e6db74>:detail</span>, <span style=color:#a6e22e>Detail</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      field <span style=color:#e6db74>:amount</span>, <span style=color:#e6db74>:decimal</span>
</span></span><span style=display:flex><span>      field <span style=color:#e6db74>:currency_code</span>, <span style=color:#e6db74>:string</span>, <span style=color:#e6db74>key</span>: <span style=color:#e6db74>&#34;currencyCode&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>We mapped the API request/response by defining the fields in a very similar way on how we do for Ecto Schemas. The main difference is that we declared the exact field key of the JSON docs in the field definition without using camelCase in elixir code. Also adding the <code>@fields_required true</code> flag in the module will make all fields required and they will be properly evaluated when loading the parameters.
Now let&rsquo;s create the HTTP client module for making the request to the external API:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span><span style=color:#66d9ef>defmodule</span> <span style=color:#a6e22e>MyApp.PaymentAPI</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>use</span> <span style=color:#a6e22e>Tesla</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>alias</span> <span style=color:#a6e22e>MyApp.ChargeRequest</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>alias</span> <span style=color:#a6e22e>MyApp.ChargeResponse</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  plug <span style=color:#a6e22e>Tesla.Middleware.BaseUrl</span>, <span style=color:#e6db74>&#34;https://api-payment-fictional.com/&#34;</span>
</span></span><span style=display:flex><span>  plug <span style=color:#a6e22e>Tesla.Middleware.JSON</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> charge_user(params) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    with <span style=color:#e6db74>:ok</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>Parameter</span><span style=color:#f92672>.</span>validate(<span style=color:#a6e22e>ChargeRequest</span>, params),
</span></span><span style=display:flex><span>         {<span style=color:#e6db74>:ok</span>, data} <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>Parameter</span><span style=color:#f92672>.</span>dump(<span style=color:#a6e22e>ChargeRequest</span>, params) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      post(<span style=color:#e6db74>&#34;/charge-user&#34;</span>, data)
</span></span><span style=display:flex><span>      <span style=color:#f92672>|&gt;</span> parse_charge_user_response()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>defp</span> parse_charge_user_response({<span style=color:#e6db74>:ok</span>, response}) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Parameter</span><span style=color:#f92672>.</span>load(<span style=color:#a6e22e>ChargeResponse</span>, response<span style=color:#f92672>.</span>body)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>defp</span> parse_charge_user_response({<span style=color:#e6db74>:error</span>, _error} <span style=color:#f92672>=</span> error) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    error
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>Now with Parameter, we are successfully validating request and response parameters, these are the main benefits:</p><ul><li>We can dump (deserialize) or load (serialize) the data using internal elixir types and correctly converts the given key/value of external data schema.</li><li>No need to add changeset functions for each schema and association. Parameter can infer everything by just having the schema definition and the parameters to parse.</li><li>Parameter can load the schemas as Maps or Struct depending on how you want the data internally. This is easily done by adding <strong>struct: true</strong> in the third argument of the <strong>load</strong> function (ex: <strong>Parameter.load(ChargeResponse, response.body, struct: true)</strong></li></ul><p>Now let&rsquo;s test this implementation and see the results.</p><p>First, we will simulate the params coming in the charge functions and validate them:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span>iex<span style=color:#f92672>&gt;</span> params <span style=color:#f92672>=</span> %{
</span></span><span style=display:flex><span>  <span style=color:#e6db74>details</span>: %{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>amount</span>: <span style=color:#a6e22e>Decimal</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#34;500&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>currency_code</span>: <span style=color:#e6db74>&#34;USD&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>discount</span>: <span style=color:#e6db74>&#34;10%&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>invoice_number</span>: <span style=color:#e6db74>&#34;ABC123&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>user</span>: %{
</span></span><span style=display:flex><span>      <span style=color:#e6db74>first_name</span>: <span style=color:#e6db74>&#34;John&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>last_name</span>: <span style=color:#e6db74>&#34;Doe&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iex<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>Parameter</span><span style=color:#f92672>.</span>validate(<span style=color:#a6e22e>MyApp.ChargeRequest</span>, params)
</span></span><span style=display:flex><span><span style=color:#e6db74>:ok</span>
</span></span></code></pre></div><p>Now with the validated parameter, we will dump its value to the API schema</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span>iex<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>Parameter</span><span style=color:#f92672>.</span>dump(<span style=color:#a6e22e>MyApp.ChargeRequest</span>, params)
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:ok</span>,
</span></span><span style=display:flex><span> %{
</span></span><span style=display:flex><span>   <span style=color:#e6db74>&#34;details&#34;</span> <span style=color:#f92672>=&gt;</span> %{
</span></span><span style=display:flex><span>     <span style=color:#e6db74>&#34;amount&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#75715e>#Decimal&lt;500&gt;,</span>
</span></span><span style=display:flex><span>     <span style=color:#e6db74>&#34;currencyCode&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;USD&#34;</span>,
</span></span><span style=display:flex><span>     <span style=color:#e6db74>&#34;discount&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;10%&#34;</span>,
</span></span><span style=display:flex><span>     <span style=color:#e6db74>&#34;invoiceNumber&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;ABC123&#34;</span>,
</span></span><span style=display:flex><span>     <span style=color:#e6db74>&#34;user&#34;</span> <span style=color:#f92672>=&gt;</span> %{
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;firstName&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;John&#34;</span>,
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;lastName&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;Doe&#34;</span>
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }}
</span></span></code></pre></div><p>We can notice that all keys were converted to camelCase as per the schema definition. This means that we have the correct schema that the provider API requires.</p><p>For parsing the response, we can use the load function to load the external parameter following our schema definition:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span>iex<span style=color:#f92672>&gt;</span> params <span style=color:#f92672>=</span> %{
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;id&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;1234&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;status&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;NEW&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;detail&#34;</span> <span style=color:#f92672>=&gt;</span> %{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;amount&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;500.00&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;billed&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;450.00&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;currencyCode&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;USD&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>iex<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>Parameter</span><span style=color:#f92672>.</span>load(<span style=color:#a6e22e>MyApp.ChargeResponse</span>, params)
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:ok</span>,
</span></span><span style=display:flex><span> %{
</span></span><span style=display:flex><span>   <span style=color:#e6db74>detail</span>: %{<span style=color:#e6db74>currency_code</span>: <span style=color:#e6db74>&#34;USD&#34;</span>, <span style=color:#e6db74>amount</span>: <span style=color:#75715e>#Decimal&lt;500.00&gt;},</span>
</span></span><span style=display:flex><span>   <span style=color:#e6db74>id</span>: <span style=color:#e6db74>&#34;1234&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#e6db74>status</span>: <span style=color:#e6db74>:new</span>
</span></span><span style=display:flex><span> }}
</span></span></code></pre></div><p>We can see that again the camelCase from the API was correctly converted to the map keys defined on the ChargeResponse schema. Also, the values are correctly parsed to the given types and the status Enum value is converted to the corresponding atom value.</p><p>With this, we have predictable data with the correct type and more confidence to handle it on our application.</p><p>For all the possibilities that Parameter has to offer, check out the <a href=https://hexdocs.pm/parameter/Parameter.html>official docs</a>.</p></section><nav class="mt-24 flex rounded-lg bg-black/[3%] p-1.5 text-lg dark:bg-white/[8%]"><a class="ml-auto flex w-1/2 items-center justify-end rounded-md p-6 pl-3 no-underline hover:bg-black/[2%]" href=https://phcurado.github.io/posts/serializing-and-deserializing-external-data-in-elixir/><span>Serializing and Deserializing external data in Elixir</span><span class=ml-1.5>→</span></a></nav></article></main><footer class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"><div class=mr-auto>&copy; 2023
<a class=link href=https://phcurado.github.io/>phcurado</a></div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>Powered by Hugo️️</a>️
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>▷ Paper 6</a></footer></body></html>